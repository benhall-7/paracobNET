<UserControl xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="https://github.com/avaloniaui"
    xmlns:vm="clr-namespace:prcEditor.ViewModels;assembly=prcEditor"
    x:Class="prcEditor.Views.ParamSearch"
    x:DataType="vm:ParamSearchViewModel">

    <Border Padding="4" Margin="0" BorderThickness="0">
        <Expander VerticalAlignment="Top" HorizontalAlignment="Stretch">
            <Expander.Resources>
                <!-- default left padding in header is 16. EVIL -->
                <Thickness x:Key="ExpanderHeaderPadding">2</Thickness>
                <Thickness x:Key="ExpanderContentPadding">2</Thickness>
            </Expander.Resources>

            <Expander.Header>
                <StackPanel>
                    <!-- Search bar -->
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <TextBox Width="180"
                            Watermark="Search hash / label"
                            Text="{Binding Query, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                            <TextBox.KeyBindings>
                                <KeyBinding Gesture="Enter"
                                    Command="{Binding RunSearchCommand}" />
                            </TextBox.KeyBindings>
                        </TextBox>

                        <CheckBox Content="Exact match"
                            IsChecked="{Binding ExactMatch, Mode=TwoWay}" />

                        <Button Content="Search"
                            Command="{Binding RunSearchCommand}" />
                    </StackPanel>

                    <!-- Result count -->
                    <TextBlock FontSize="11"
                        Foreground="Gray"
                        Text="{Binding Results.Count, StringFormat='Matches: {0}'}" />
                </StackPanel>
            </Expander.Header>

            <!-- Results list -->
            <ListBox MaxHeight="300"
                ItemsSource="{Binding Results}"
                SelectedItem="{Binding SelectedResult, Mode=TwoWay}"
                SelectionMode="Single">
                <ListBox.Styles>
                    <Style Selector="ListBoxItem">
                        <Setter Property="Padding" Value="4" />
                    </Style>
                </ListBox.Styles>

                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <StackPanel Margin="1">
                            <!-- Main line: node / hash info -->
                            <TextBlock Text="{Binding DisplayText}" />

                            <!-- Route (smaller, gray) -->
                            <TextBlock Text="{Binding RouteText}"
                                FontSize="10"
                                Foreground="Gray" />
                        </StackPanel>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </Expander>
    </Border>
</UserControl>